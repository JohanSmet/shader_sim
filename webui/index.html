<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Emscripten-Generated Code</title>
    <style>
      .emscripten { padding-right: 0; margin-left: auto; margin-right: auto; display: block; }
      textarea.emscripten { font-family: monospace; width: 80%; }
      div.emscripten { text-align: center; }

      .spinner {
        height: 50px;
        width: 50px;
        margin: 0px auto;
        -webkit-animation: rotation .8s linear infinite;
        -moz-animation: rotation .8s linear infinite;
        -o-animation: rotation .8s linear infinite;
        animation: rotation 0.8s linear infinite;
        border-left: 10px solid rgb(0,150,240);
        border-right: 10px solid rgb(0,150,240);
        border-bottom: 10px solid rgb(0,150,240);
        border-top: 10px solid rgb(100,0,200);
        border-radius: 100%;
        background-color: rgb(200,100,250);
      }
      @-webkit-keyframes rotation {
        from {-webkit-transform: rotate(0deg);}
        to {-webkit-transform: rotate(360deg);}
      }
      @-moz-keyframes rotation {
        from {-moz-transform: rotate(0deg);}
        to {-moz-transform: rotate(360deg);}
      }
      @-o-keyframes rotation {
        from {-o-transform: rotate(0deg);}
        to {-o-transform: rotate(360deg);}
      }
      @keyframes rotation {
        from {transform: rotate(0deg);}
        to {transform: rotate(360deg);}
      }

    </style>
	<script src="jquery-3.3.1.min.js"></script>
  </head>
  <body>
    <div id="loading">
		<figure style="overflow:visible;" id="spinner">
			<div class="spinner"></div>
			<center style="margin-top:0.5em"><strong>WebAssembly Modules</strong></center>
		</figure>
		<div class="emscripten" id="status">Downloading...</div>
		<div class="emscripten">
		  <progress value="0" max="100" id="progress" hidden=1></progress>  
		</div>
    </div>

	<div id="main">
		<div id="header">
			<input type="button" id="btnLoad" value="Load shader">
		</div>
		<div id="shader" />
	</div>
    
	<div id="footer">
		<!-- Emscripten stdout/stderr: -->
    	<textarea class="emscripten" id="output" rows="8"></textarea>
	</div>
    <script type="text/javascript" src="emscripten.js"></script>
    <script async type="text/javascript" src="wasm/shader_sim_api.js"></script>
	<script type="text/javascript">
		Module.onRuntimeInitialized = function() {
			$("#main").show();
			wasm_wrap_functions();
		}
		$("#main").hide();

		var simapi_create_context = null;
		var simapi_release_context = null;
		var simapi_spirv_load_file = null;
		var simapi_spirv_opcode_count = null;
		var simapi_spirv_opcode_text = null;

		var simapi_context = null;

		function wasm_wrap_functions() {
			simapi_create_context = Module.cwrap('simapi_create_context', 'number', []); 
			simapi_release_context =  Module.cwrap('simapi_release_context', null, ['number']);
			simapi_spirv_load_file = Module.cwrap('simapi_spirv_load_file', 'number', ['number', 'string']);
			simapi_spirv_opcode_count = Module.cwrap('simapi_spirv_opcode_count', 'number', ['number']);
			simapi_spirv_opcode_text = Module.cwrap('simapi_spirv_opcode_text', 'string', ['number, number']);
		}

		$("#btnLoad").on("click", function (event) {
			simapi_context = simapi_create_context();
			simapi_spirv_load_file(simapi_context, 'examples/vert_arith_int.spv');
			
			var f_shader_ui = $("#shader");
			var f_count = simapi_spirv_opcode_count(simapi_context);
			for (var f_idx = 0; f_idx < f_count; ++f_idx) {
				f_shader_ui.append($('<div />').text(simapi_spirv_opcode_text(simapi_context, f_idx)));
			}
		});
	</script>
  </body>
</html>

